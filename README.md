# 待办事项应用程序

一个现代化、高性能的待办事项桌面应用程序（Electron），采用 macOS 风格卡片化设计，支持拖拽排序、搜索与标签筛选。

## 功能特性

- 🎨 现代化、精致美观的用户界面设计
- ✅ 完整的待办事项管理功能（添加、编辑、删除、标记完成）
- 📊 实时统计功能
- 🗑️ 批量清除已完成事项
- 💾 数据持久化存储（应用程序关闭后数据不丢失）
- 🖥️ Windows桌面应用程序（可移动、可调整大小）
- 📱 响应式设计，支持移动设备
- 🔄 窗口控制（最小化、关闭、缩放切换、标题栏拖拽）
- 🔍 即时搜索（匹配原始文本，包含 #标签）
- #️⃣ 标签筛选（根据当前任务动态生成；无标签自动隐藏）
- 🧲 拖拽排序并持久化
- 🎯 智能UI交互（根据内容动态显示/隐藏按钮）

## 技术架构

### 核心技术栈

- **Electron** - 跨平台桌面应用框架
- **HTML5/CSS3/JavaScript** - 现代前端技术
- **Node.js** - 后端运行时环境

### 代码优化特性

- **模块化设计** - 代码结构清晰，职责分离
- **性能优化** - 优化的滚动、渲染和事件处理
- **内存管理** - 高效的数据存储和清理机制
- **用户体验** - 流畅的动画和交互反馈

## 数据持久化

### 存储机制

应用程序使用文件系统持久化存储待办事项数据，确保即使应用程序关闭或系统重启，数据也不会丢失。

### 存储位置

- 存于 Electron `app.getPath('userData')/todos.json`
- 首次运行会尝试从旧路径 `~/.todo-app/todos.json` 迁移一次

### 数据格式

```json
[
  {
    "id": 1754712076088,
    "text": "待办事项内容",
    "completed": false,
    "createdAt": "2025-08-09T04:01:16.088Z"
  }
]
```

### 技术实现

- 异步文件操作（fs.promises）
- 首次初始化与旧数据一次性迁移
- 每次变更实时写盘
- 基础异常处理

### 安全特性

- **用户目录隔离**：数据存储在用户主目录下，避免权限问题
- **JSON格式**：人类可读的数据格式，便于调试和备份
- **原子操作**：文件写入使用原子操作，防止数据损坏

## 项目结构

```
├── main.js          # Electron主进程（窗口控制和IPC通信）
├── preload.js       # 预加载脚本（安全API暴露）
├── index.html       # 主界面HTML
├── styles.css       # 样式与动效（mac 风格、占位符、滚动优化）
├── renderer.js      # 渲染进程：增删改查/过滤/拖拽/统计/UI
├── package.json     # 项目配置和脚本
└── electron-builder.json  # 构建配置
```

## 核心优化

### 1. 代码结构优化

- **模块化设计**：将功能拆分为独立模块，提高可维护性
- **职责分离**：主进程、预加载、渲染进程职责明确
- **代码复用**：提取公共函数，减少重复代码

### 2. 性能优化

- **DOM操作优化**：缓存DOM元素，减少查询次数
- **事件处理优化**：合理的事件绑定和解绑机制
- **滚动性能**：优化的滚动条和列表渲染
- **内存管理**：及时清理无用数据和事件监听器

### 3. 用户体验优化

- **固定布局**：界面大小固定，内容滚动浏览
- **清晰滚动条**：自定义样式的滚动条，易于操作
- **流畅动画**：优化的过渡动画和交互反馈
- **响应式设计**：适配不同屏幕尺寸

## 安装和运行

### 开发模式运行

```powershell
# 安装依赖
npm install

# 启动应用程序
npm start
```

### 构建 Windows 安装包/便携包

```powershell
# 构建（Windows）
npm run dist
```

构建产物位于 `dist/`（含 nsis 安装包与 portable 包）。

若构建失败（Exit Code: 1），请先执行：

- 删除 `node_modules` 与 `dist` 后重新安装：`npm ci`
- 确认使用 Node 18/20 LTS；Electron Builder 26.x 与 Electron 37.x 兼容
- PowerShell 以管理员运行，避免签名或权限问题

## 使用说明

1. **添加待办事项** - 在输入框输入内容，点击添加或按回车
2. **标记完成** - 点击待办事项前的复选框标记为已完成
3. **编辑任务** - 悬停待办事项可显示编辑按钮，点击修改内容
4. **删除任务** - 悬停待办事项可显示删除按钮，点击移除任务
5. **窗口控制** - 左上角交通灯：关闭/最小化/缩放（在两种尺寸间切换）
6. **窗口移动** - 在标题栏区域可以拖拽移动应用程序
7. **搜索与筛选** - 输入框即时搜索；点击标签按钮进行交集筛选
8. **批量清理** - 点击"清除已完成"按钮批量删除所有已完成的待办事项

## API接口

### 主进程IPC接口

```javascript
// 待办事项操作
electronAPI.getTodos()        // 获取所有待办事项
electronAPI.addTodo(todo)     // 添加待办事项
electronAPI.updateTodo(todo)  // 更新待办事项
electronAPI.deleteTodo(id)    // 删除待办事项
electronAPI.clearCompleted()  // 清除已完成事项

// 窗口操作
electronAPI.minimize()        // 最小化窗口
electronAPI.close()           // 关闭窗口
electronAPI.toggleZoom()      // 缩放切换（两种尺寸）

// 排序持久化
electronAPI.reorderTodos(idOrder)
```

## 许可证

MIT License

## 开发说明

### 代码规范

- 使用ES6+语法特性
- 遵循模块化开发模式
- 保持代码简洁和可读性
- 合理的错误处理机制

### 性能监控

- 避免频繁的DOM操作
- 合理使用事件委托
- 及时清理事件监听器
- 优化内存使用
